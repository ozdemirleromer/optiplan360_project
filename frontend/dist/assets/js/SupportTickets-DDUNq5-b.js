import{i as e,j as t,B as a,d as r,f as s}from"./index-BqsYehSy.js";import{r as l,M as i,Y as n,a as c,ac as d,N as x}from"./ui-vendor-X7YeR1nJ.js";import{c as o}from"./crmService-CaLpglF9.js";import"./react-vendor-BTlmOg1k.js";import"./export-jspdf-ClKeqeik.js";import"./state-CRAppeNE.js";import"./export-xlsx-C5xT2hrF.js";function m(){var m;const[b,p]=l.useState([]),[u,v]=l.useState(null),[h,f]=l.useState(!0),[j,g]=l.useState(""),[N,y]=l.useState(""),{user:w}=e(),k=async()=>{try{f(!0);const e=await o.listTickets(N?{status:N}:void 0);p(e)}catch(e){}finally{f(!1)}},S=async e=>{try{const t=await o.getTicket(e);v(t)}catch(t){}};l.useEffect(()=>{k()},[N]);const E=async e=>{if(e.preventDefault(),u&&j.trim())try{await o.replyTicket(u.id,j,!1),g(""),await S(u.id),await k()}catch(t){}},O=e=>{switch(e){case"OPEN":return"info";case"IN_PROGRESS":return"warning";case"RESOLVED":return"success";default:return"default"}},D=e=>{switch(e){case"OPEN":return"Açık";case"IN_PROGRESS":return"İşlemde";case"RESOLVED":return"Çözümlendi";case"CLOSED":return"Kapatıldı";default:return e}},R=e=>{switch(e){case"LOW":return t.jsx("span",{className:"text-xs text-[var(--text-muted)]",children:"Düşük"});case"NORMAL":return t.jsx("span",{className:"text-xs text-blue-400 font-medium",children:"Normal"});case"HIGH":return t.jsx("span",{className:"text-xs text-orange-400 font-bold",children:"Yüksek"});case"URGENT":return t.jsx("span",{className:"text-xs text-red-500 font-bold",children:"Acil"});default:return null}};return t.jsx("div",{className:"electric-page",children:t.jsxs("div",{className:"app-page-container flex flex-col h-full h-[calc(100vh-20px)]",children:[t.jsxs("div",{className:"flex justify-between items-center mb-5 shrink-0 px-2",children:[t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-[var(--text-main)] m-0 flex items-center gap-3",children:[t.jsx(i,{className:"text-[var(--primary)]",size:28}),"Müşteri Talepleri (Destek)"]}),t.jsx("p",{className:"text-[var(--text-muted)] text-sm mt-1 mb-0",children:"Özel müşterilerinizden gelen destek biletleri ve yazışmaları"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs(a,{variant:"secondary",onClick:k,children:[t.jsx(n,{size:16,className:h?"animate-spin":""}),"Yenile"]}),t.jsxs("select",{value:N,onChange:e=>y(e.target.value),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--bg-main)] text-[var(--text-main)] focus:outline-none focus:border-[var(--primary)] transition-colors",children:[t.jsx("option",{value:"",children:"Tümü"}),t.jsx("option",{value:"OPEN",children:"Yeni Gelenler (Açık)"}),t.jsx("option",{value:"IN_PROGRESS",children:"İşlemde Olanlar"}),t.jsx("option",{value:"RESOLVED",children:"Çözülenler"})]})]})]}),t.jsxs("div",{className:"flex gap-5 flex-1 min-h-0",children:[t.jsxs(r,{className:"w-1/3 flex flex-col p-0 overflow-hidden border border-[var(--border)] bg-[var(--bg-card)]",children:[t.jsx("div",{className:"p-4 border-b border-[var(--border)] bg-[rgba(255,255,255,0.02)] shrink-0",children:t.jsx("h3",{className:"font-semibold text-[var(--text-main)] m-0",children:"Gelen Kayıtlar"})}),t.jsx("div",{className:"flex-1 overflow-y-auto w-full p-2 space-y-2",children:h&&0===b.length?t.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-[var(--text-muted)] h-full",children:[t.jsx(n,{className:"w-8 h-8 animate-spin mb-4 opacity-50 text-[var(--primary)]"}),t.jsx("p",{children:"Biletler yükleniyor..."})]}):0===b.length?t.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-[var(--text-muted)] h-full",children:[t.jsx(c,{className:"w-12 h-12 text-[var(--success)] mb-3 opacity-80"}),t.jsxs("p",{className:"text-sm font-medium text-center",children:["Tüm kayıtlar temiz!",t.jsx("br",{}),"Bekleyen destek talebi yok."]})]}):t.jsx("ul",{className:"m-0 p-0 list-none space-y-1",children:b.map(e=>{const a=(null==u?void 0:u.id)===e.id;return t.jsxs("li",{onClick:()=>S(e.id),className:"p-4 rounded-xl cursor-pointer transition-all border "+(a?"border-[var(--primary)] bg-[rgba(var(--primary-rgb),0.08)]":"border-transparent bg-[rgba(255,255,255,0.02)] hover:bg-[rgba(255,255,255,0.06)]"),children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsx("h4",{className:"text-sm font-semibold m-0 line-clamp-1 pr-2 "+(a?"text-[var(--primary)]":"text-[var(--text-main)]"),children:e.subject}),t.jsx(s,{variant:O(e.status),children:D(e.status)})]}),t.jsx("div",{className:"text-xs text-[var(--text-muted)] mb-3",children:e.accountName||"Bilinmiyor"}),t.jsxs("div",{className:"flex justify-between items-center text-xs mt-auto pt-2 border-t border-[var(--border)] border-opacity-50",children:[t.jsxs("span",{className:"flex items-center text-[var(--text-dim)]",children:[t.jsx(d,{className:"w-3.5 h-3.5 mr-1"}),new Date(e.updatedAt).toLocaleDateString("tr-TR")]}),R(e.priority)]})]},e.id)})})})]}),t.jsx(r,{className:"w-2/3 flex flex-col p-0 overflow-hidden relative border border-[var(--border)] bg-[var(--bg-card)]",children:u?t.jsxs("div",{className:"flex flex-col h-full w-full",children:[t.jsxs("div",{className:"p-5 border-b border-[var(--border)] bg-[rgba(255,255,255,0.02)] flex justify-between items-start shrink-0 backdrop-blur-md",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-[var(--text-main)] m-0 mb-1.5 flex items-center gap-2",children:u.subject}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--text-muted)]",children:[t.jsx("span",{className:"font-medium text-[var(--text-main)]",children:u.accountName}),t.jsx("span",{className:"w-1 h-1 rounded-full bg-[var(--border)]"}),t.jsx("span",{children:"Özel Müşteri"})]})]}),t.jsx("div",{className:"flex gap-2",children:t.jsxs("select",{value:u.status,onChange:e=>(async e=>{if(u)try{const t=await o.updateTicketStatus(u.id,e);v(t),await k()}catch(t){}})(e.target.value),className:"text-sm border border-[var(--primary)] text-[var(--primary)] rounded-lg px-3 py-1.5 bg-[rgba(var(--primary-rgb),0.1)] font-medium focus:outline-none focus:ring-2 focus:ring-[var(--primary)] transition-all cursor-pointer",children:[t.jsx("option",{value:"OPEN",className:"bg-[var(--bg-card)] text-[var(--text-main)]",children:"Açık (Yeni)"}),t.jsx("option",{value:"IN_PROGRESS",className:"bg-[var(--bg-card)] text-[var(--text-main)]",children:"İşleme Al"}),t.jsx("option",{value:"RESOLVED",className:"bg-[var(--bg-card)] text-[var(--text-main)]",children:"Çözüldü Olarak İşaretle"}),t.jsx("option",{value:"CLOSED",className:"bg-[var(--bg-card)] text-[var(--text-main)]",children:"Kapat"})]})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-[rgba(0,0,0,0.2)] flex flex-col gap-6 custom-scrollbar",children:[t.jsxs("div",{className:"bg-[var(--bg-elevated)] p-5 rounded-xl border border-[var(--border)] shadow-lg w-full relative overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-[var(--text-muted)] opacity-50"}),t.jsxs("div",{className:"text-xs font-semibold text-[var(--text-muted)] mb-3 pb-3 border-b border-[var(--border)] flex justify-between items-center px-2",children:[t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx(i,{size:14})," İlk Talep (Açıklama)"]}),t.jsxs("span",{className:"flex items-center gap-1.5",children:[t.jsx(d,{size:14})," ",new Date(u.createdAt).toLocaleString("tr-TR")]})]}),t.jsx("p",{className:"text-[15px] text-[var(--text-main)] whitespace-pre-wrap m-0 px-2 leading-relaxed",children:u.description})]}),t.jsx("div",{className:"flex flex-col gap-4 mt-2",children:null==(m=u.messages)?void 0:m.map(e=>{const a=String(e.senderId)===String(null==w?void 0:w.id),r=e.senderName&&e.senderName!==u.accountName;return t.jsx("div",{className:"flex "+(a||r?"justify-end":"justify-start"),children:t.jsxs("div",{className:"max-w-[85%] p-4 rounded-2xl shadow-md "+(a||r?"bg-[var(--primary)] text-white rounded-br-sm":"bg-[var(--bg-elevated)] border border-[var(--border)] text-[var(--text-main)] rounded-bl-sm"),children:[t.jsxs("div",{className:"text-xs font-bold mb-2 flex justify-between gap-6 items-center border-b border-white/10 pb-2 "+(a||r?"text-white/80":"text-[var(--text-muted)]"),children:[t.jsxs("span",{className:"flex items-center gap-1.5",children:[e.senderName||"Bilinmiyor",(a||r)&&t.jsx("span",{className:"scale-75 origin-left tracking-wide uppercase px-1.5 py-0 border-none bg-black/20 text-white rounded",children:t.jsx(s,{variant:"success",children:"YETKİLİ"})})]}),t.jsx("span",{className:"font-mono text-[10px] opacity-70",children:new Date(e.createdAt).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"})})]}),t.jsx("p",{className:"m-0 text-[14px] whitespace-pre-wrap leading-relaxed",children:e.message})]})},e.id)})})]}),t.jsx("div",{className:"p-5 border-t border-[var(--border)] bg-[var(--bg-card)] shrink-0",children:t.jsxs("form",{onSubmit:E,className:"flex gap-3 items-end relative",children:[t.jsx("textarea",{rows:2,className:"flex-1 border border-[var(--border)] rounded-xl p-4 text-[15px] focus:outline-none focus:border-[var(--primary)] focus:ring-1 focus:ring-[var(--primary)] resize-none bg-[var(--bg-main)] text-[var(--text-main)] placeholder-[var(--text-dim)] transition-all custom-scrollbar",placeholder:"Müşteriye yanıt yazın... (Göndermek için Enter)",value:j,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E(e))}}),t.jsx("button",{type:"submit",disabled:!j.trim(),className:"h-[58px] min-w-[58px] rounded-xl flex items-center justify-center p-0 transition-transform active:scale-95 shadow-md shadow-[var(--primary-glow)] disabled:opacity-50 disabled:shadow-none bg-[var(--primary)] text-white hover:brightness-110",children:t.jsx(x,{className:"w-5 h-5 -ml-0.5"})})]})})]}):t.jsxs("div",{className:"flex flex-col h-full items-center justify-center text-[var(--text-dim)] bg-[rgba(0,0,0,0.1)]",children:[t.jsx("div",{className:"w-24 h-24 mb-6 rounded-full bg-[rgba(255,255,255,0.03)] flex items-center justify-center border border-[var(--border)]",children:t.jsx(i,{className:"w-10 h-10 text-[var(--text-muted)] opacity-50"})}),t.jsx("p",{className:"text-lg font-medium text-[var(--text-muted)]",children:"Destek Talebi Seçin"}),t.jsx("p",{className:"text-sm mt-2 opacity-70",children:"Detayları ve yazışmaları görmek için listeden bir kayıt seçin."})]})})]})]})})}export{m as default};
