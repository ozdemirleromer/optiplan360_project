import{j as e,d as t,C as i,T as n,I as r,R as o,p as a,m as l,B as d,c as s,K as c,t as u}from"./index-BqsYehSy.js";import{r as m,X as g,B as p,T as x,aj as h,av as y,f,Q as b,d as j,E as v,ac as S,e as z,N as T,Y as D,V as A,C as E}from"./ui-vendor-X7YeR1nJ.js";import{R as k,i as L,P as R}from"./paymentService-B1S5G9JA.js";import{E as I}from"./export-jspdf-ClKeqeik.js";import{u as F,w as C}from"./export-xlsx-C5xT2hrF.js";import"./react-vendor-BTlmOg1k.js";import"./state-CRAppeNE.js";function _({invoice:d,onSubmit:s,onClose:c}){const[u,h]=m.useState({account_id:(null==d?void 0:d.accountId)||"",subtotal:(null==d?void 0:d.subtotal)||0,tax_rate:(null==d?void 0:d.taxAmount)&&d.subtotal?d.taxAmount/d.subtotal*100:20,discount_amount:(null==d?void 0:d.discountAmount)||0,invoice_type:(null==d?void 0:d.invoiceType)||"SALES",notes:(null==d?void 0:d.notes)||"",reminder_type:(null==d?void 0:d.reminderType)||void 0,next_reminder_date:(null==d?void 0:d.nextReminderDate)||"",due_date:(null==d?void 0:d.dueDate)||""}),[y,f]=m.useState(!1),[b,j]=m.useState(null),v=(e,t)=>{h(i=>({...i,[e]:t})),j(null)},S=()=>{const e=(u.subtotal-u.discount_amount)*(u.tax_rate/100);return u.subtotal-u.discount_amount+e};return e.jsxs(t,{style:{width:600,maxHeight:"90vh",overflow:"auto",background:i.bg.surface},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20,paddingBottom:16,borderBottom:`1px solid ${i.border}`},children:[e.jsx("h2",{style:{margin:0,fontSize:n.fontSize.lg,fontWeight:n.fontWeight.bold},children:d?"Fatura Düzenle":"Yeni Fatura"}),e.jsx("button",{onClick:c,style:{border:"none",background:"transparent",cursor:"pointer",color:i.muted,padding:4},children:e.jsx(g,{size:20})})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),u.account_id.trim())if(u.subtotal<=0)j("Tutar 0'dan büyük olmalıdır");else{f(!0),j(null);try{const e={account_id:u.account_id,subtotal:u.subtotal,tax_rate:u.tax_rate,discount_amount:u.discount_amount,total_amount:S(),invoice_type:u.invoice_type,notes:u.notes,due_date:u.due_date||void 0,reminder_type:u.reminder_type||void 0,next_reminder_date:u.next_reminder_date||void 0};let t;t=(null==d?void 0:d.id)?await L.update(d.id,e):await L.create(e),s(t),c()}catch(t){j(t instanceof Error?t.message:"Fatura islemi basarisiz oldu")}finally{f(!1)}}else j("Hesap seçilmesi gereklidir")},style:{display:"grid",gap:16},children:[e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h3",{style:{fontSize:n.fontSize.sm,fontWeight:n.fontWeight.semibold,color:i.muted},children:"HESAP BİLGİLERİ"}),e.jsx(r,{label:"Hesap ID",type:"text",value:u.account_id,onChange:e=>v("account_id",e.target.value),required:!0})]}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h3",{style:{fontSize:n.fontSize.sm,fontWeight:n.fontWeight.semibold,color:i.muted},children:"TUTAR BİLGİLERİ"}),e.jsx(r,{label:"Ara Toplam (₺)",type:"number",value:u.subtotal,onChange:e=>v("subtotal",parseFloat(e.target.value)||0),required:!0}),e.jsx(r,{label:"KDV Oranı (%)",type:"number",value:u.tax_rate,onChange:e=>v("tax_rate",parseFloat(e.target.value)||0),min:"0",max:"100"}),e.jsx(r,{label:"İndirim (₺)",type:"number",value:u.discount_amount,onChange:e=>v("discount_amount",parseFloat(e.target.value)||0),min:"0"}),e.jsxs("div",{style:{padding:12,background:a(.05),borderRadius:o.md,border:`1px solid ${i.border}`},children:[e.jsx("div",{style:{fontSize:n.fontSize.sm,color:i.muted,marginBottom:4},children:"Toplam Tutar"}),e.jsxs("div",{style:{fontSize:n.fontSize.lg,fontWeight:n.fontWeight.bold,color:i.primary[500]},children:["₺",S().toLocaleString("tr-TR",{maximumFractionDigits:2})]})]})]}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h3",{style:{fontSize:n.fontSize.sm,fontWeight:n.fontWeight.semibold,color:i.muted},children:"ÖDEME BİLGİLERİ"}),e.jsx(r,{label:"Vade Tarihi",type:"date",value:u.due_date,onChange:e=>v("due_date",e.target.value)}),e.jsx(l,{label:"Fatura Türü",value:u.invoice_type,onChange:e=>v("invoice_type",e),options:[{value:"SALES",label:"Satış"},{value:"SERVICE",label:"Hizmet"},{value:"CREDIT",label:"Alacak"}]})]}),e.jsxs("div",{style:{display:"grid",gap:12,padding:12,background:a(.05),borderRadius:o.md,border:`1px solid ${a(.2)}`},children:[e.jsxs("h3",{style:{fontSize:n.fontSize.sm,fontWeight:n.fontWeight.semibold,color:i.muted,margin:0,display:"flex",alignItems:"center",gap:6},children:[e.jsx(p,{size:14,"aria-hidden":!0})," ÖDEME HATIRLATICI"]}),e.jsx(l,{label:"Hatırlatma Türü",value:u.reminder_type||"",onChange:e=>v("reminder_type",""===e?void 0:e),options:[{value:"",label:"Hatırlatıcı Yok"},{value:k.EMAIL,label:"E-posta"},{value:k.SMS,label:"SMS"},{value:k.IN_APP,label:"Uygulama İçi"},{value:k.LETTER,label:"Mektup"}]}),u.reminder_type&&e.jsx(r,{label:"Sonraki Hatırlatma Tarihi",type:"datetime-local",value:u.next_reminder_date,onChange:e=>v("next_reminder_date",e.target.value)})]}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsx("h3",{style:{fontSize:n.fontSize.sm,fontWeight:n.fontWeight.semibold,color:i.muted},children:"NOTLAR"}),e.jsx("textarea",{value:u.notes,onChange:e=>v("notes",e.target.value),placeholder:"Fatura hakkında notlar...",style:{padding:12,border:`1px solid ${i.border}`,borderRadius:o.md,fontFamily:n.fontFamily.base,fontSize:n.fontSize.sm,color:i.text,background:i.panel,resize:"vertical",minHeight:80}})]}),b&&e.jsxs("div",{style:{padding:12,background:i.error.light,border:`1px solid ${i.error.DEFAULT}`,borderRadius:o.md,color:i.error.DEFAULT,fontSize:n.fontSize.sm,display:"flex",alignItems:"center",gap:6},children:[e.jsx(x,{size:14,"aria-hidden":!0})," ",b]}),e.jsxs("div",{style:{display:"flex",gap:12,paddingTop:12,borderTop:`1px solid ${i.border}`},children:[e.jsx("button",{type:"button",onClick:c,disabled:y,style:{flex:1,padding:"10px 16px",border:`1px solid ${i.border}`,background:i.bg.subtle,color:i.text,borderRadius:o.md,cursor:y?"not-allowed":"pointer",fontSize:n.fontSize.sm,fontWeight:n.fontWeight.medium,opacity:y?.5:1},children:"İptal"}),e.jsx("button",{type:"submit",disabled:y,style:{flex:1,padding:"10px 16px",border:"none",background:i.primary[500],color:"white",borderRadius:o.md,cursor:y?"not-allowed":"pointer",fontSize:n.fontSize.sm,fontWeight:n.fontWeight.medium,opacity:y?.7:1},children:y?"İşleniyor...":d?"Güncelle":"Oluştur"})]})]})]})}function W({invoices:r,loading:a,onEdit:l,onDelete:d,onRefresh:s}){const[c,u]=m.useState(""),[g,p]=m.useState(""),x=r.filter(e=>{const t=!c||e.status===c,i=!g||e.invoiceNumber.toLowerCase().includes(g.toLowerCase())||e.accountId.toLowerCase().includes(g.toLowerCase());return t&&i}),T=t=>{switch(t){case R.PAID:return e.jsx(z,{size:16,color:i.success.DEFAULT});case R.PENDING:return e.jsx(S,{size:16,color:i.accent[400]});case R.PARTIAL:return e.jsx(v,{size:16,color:i.info.DEFAULT});case R.OVERDUE:return e.jsx(j,{size:16,color:i.error.DEFAULT});case R.CANCELLED:return e.jsx(b,{size:16,color:i.muted});default:return null}},D=e=>({[R.PAID]:"Ödendi",[R.PENDING]:"Beklemede",[R.PARTIAL]:"Kısmi Ödendi",[R.OVERDUE]:"Vadesi Geçti",[R.CANCELLED]:"İptal"}[e]||e),A=e=>{if(!e.reminderType)return null;return`${{EMAIL:"E-posta",SMS:"SMS",IN_APP:"Uygulama",LETTER:"Mektup"}[e.reminderType]||""} · ${{PENDING:"Beklemede",SENT:"Gönderildi",READ:"Okundu",IGNORED:"Göz Ardı",BOUNCED:"Geri Döndü"}[e.reminderStatus||""]||""}`};return a?e.jsx(t,{children:e.jsx("div",{style:{textAlign:"center",padding:40,color:i.muted},children:"Yükleniyor..."})}):0===r.length?e.jsx(t,{children:e.jsx("div",{style:{textAlign:"center",padding:40,color:i.muted},children:"Henüz fatura yok"})}):e.jsxs(t,{style:{overflow:"hidden"},children:[e.jsxs("div",{style:{padding:16,borderBottom:`1px solid ${i.border}`,display:"grid",gap:12,gridTemplateColumns:"1fr 1fr auto",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:n.fontSize.xs,color:i.muted,display:"block",marginBottom:4},children:"Ara"}),e.jsx("input",{type:"text",placeholder:"Fatura No...",value:g,onChange:e=>p(e.target.value),style:{width:"100%",padding:"8px 12px",border:`1px solid ${i.border}`,borderRadius:o.md,background:i.panel,color:i.text,fontSize:n.fontSize.sm}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:n.fontSize.xs,color:i.muted,display:"block",marginBottom:4},children:"Durum"}),e.jsxs("select",{value:c,onChange:e=>u(e.target.value),style:{width:"100%",padding:"8px 12px",border:`1px solid ${i.border}`,borderRadius:o.md,background:i.panel,color:i.text,fontSize:n.fontSize.sm},children:[e.jsx("option",{value:"",children:"Tümü"}),e.jsx("option",{value:R.PAID,children:"Ödendi"}),e.jsx("option",{value:R.PENDING,children:"Beklemede"}),e.jsx("option",{value:R.PARTIAL,children:"Kısmi Ödendi"}),e.jsx("option",{value:R.OVERDUE,children:"Vadesi Geçti"})]})]}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsxs("button",{onClick:()=>(e=>{const t=new I;t.setFontSize(20),t.text("Fatura Raporu",14,22),t.setFontSize(10),t.text(`Oluşturma Tarihi: ${(new Date).toLocaleDateString("tr-TR")}`,14,32);const i=e.map(e=>[e.invoiceNumber,e.accountId,`₺${(e.totalAmount??0).toLocaleString("tr-TR",{maximumFractionDigits:2})}`,`₺${(e.paidAmount??0).toLocaleString("tr-TR",{maximumFractionDigits:2})}`,e.status,e.reminderType||"-"]);t.autoTable({head:[["Fatura No","Hesap","Tutar","Ödenen","Durum","Hatırlatıcı"]],body:i,startY:40,theme:"grid",styles:{font:"helvetica",fontSize:9},headStyles:{fillColor:[59,130,246],textColor:[255,255,255],fontStyle:"bold"}}),t.save(`faturalar-${(new Date).getTime()}.pdf`)})(x),style:{padding:"8px 12px",background:i.error.DEFAULT,color:"white",border:"none",borderRadius:o.md,cursor:"pointer",fontSize:n.fontSize.xs,fontWeight:"600",display:"flex",alignItems:"center",gap:4},children:[e.jsx(h,{size:14})," PDF"]}),e.jsxs("button",{onClick:()=>(e=>{const t=e.map(e=>({"Fatura No":e.invoiceNumber,Hesap:e.accountId,"Tür":e.invoiceType,"Ara Toplam":e.subtotal,KDV:e.taxAmount,"İndirim":e.discountAmount,Toplam:e.totalAmount,"Ödenen":e.paidAmount,Kalan:e.remainingAmount,Durum:e.status,"Vade Tarihi":e.dueDate?new Date(e.dueDate).toLocaleDateString("tr-TR"):"-","Hatırlatıcı Türü":e.reminderType||"-","Hatırlatıcı Durumu":e.reminderStatus||"-"})),i=F.json_to_sheet(t),n=F.book_new();F.book_append_sheet(n,i,"Faturalar"),i["!cols"]=[{wch:15},{wch:15},{wch:10},{wch:12},{wch:10},{wch:10},{wch:12},{wch:12},{wch:10},{wch:12},{wch:15},{wch:15},{wch:15}],C(n,`faturalar-${(new Date).getTime()}.xlsx`)})(x),style:{padding:"8px 12px",background:i.success.DEFAULT,color:"white",border:"none",borderRadius:o.md,cursor:"pointer",fontSize:n.fontSize.xs,fontWeight:"600",display:"flex",alignItems:"center",gap:4},children:[e.jsx(h,{size:14})," Excel"]})]})]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:n.fontSize.sm},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:`1px solid ${i.border}`,background:i.bg.subtle},children:[e.jsx("th",{style:{padding:12,textAlign:"left",fontWeight:"600"},children:"Fatura No"}),e.jsx("th",{style:{padding:12,textAlign:"left",fontWeight:"600"},children:"Hesap"}),e.jsx("th",{style:{padding:12,textAlign:"right",fontWeight:"600"},children:"Tutar"}),e.jsx("th",{style:{padding:12,textAlign:"right",fontWeight:"600"},children:"Ödenen"}),e.jsx("th",{style:{padding:12,textAlign:"center",fontWeight:"600"},children:"Durum"}),e.jsx("th",{style:{padding:12,textAlign:"center",fontWeight:"600"},children:"Hatırlatıcı"}),e.jsx("th",{style:{padding:12,textAlign:"right",fontWeight:"600"},children:"Vade"}),e.jsx("th",{style:{padding:12,textAlign:"center",fontWeight:"600"},children:"İşlem"})]})}),e.jsx("tbody",{children:x.map(t=>{return e.jsxs("tr",{style:{borderBottom:`1px solid ${i.border}`},children:[e.jsx("td",{style:{padding:12,fontWeight:"600"},children:t.invoiceNumber??"—"}),e.jsx("td",{style:{padding:12,color:i.muted},children:t.accountId??"—"}),e.jsxs("td",{style:{padding:12,textAlign:"right",fontWeight:"600"},children:["₺",(t.totalAmount??0).toLocaleString("tr-TR",{maximumFractionDigits:2})]}),e.jsxs("td",{style:{padding:12,textAlign:"right"},children:["₺",(t.paidAmount??0).toLocaleString("tr-TR",{maximumFractionDigits:2})]}),e.jsxs("td",{style:{padding:12,textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",gap:6},children:[T(t.status)," ",e.jsx("span",{style:{color:(n=t.status,{[R.PAID]:i.success.DEFAULT,[R.PENDING]:i.accent[400],[R.PARTIAL]:i.info.DEFAULT,[R.OVERDUE]:i.error.DEFAULT}[n]||i.muted)},children:D(t.status)})]}),e.jsx("td",{style:{padding:12,textAlign:"center"},children:A(t)||"—"}),e.jsx("td",{style:{padding:12,textAlign:"right",color:i.muted},children:t.dueDate?new Date(t.dueDate).toLocaleDateString("tr-TR"):"—"}),e.jsx("td",{style:{padding:12,textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>l(t),style:{border:"none",background:"transparent",cursor:"pointer",color:i.info.DEFAULT,padding:4},title:"Düzenle",children:e.jsx(y,{size:16})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm(`"${e.invoiceNumber}" faturası silmek istediğinizden emin misiniz?`))try{await L.delete(e.id),d&&d(e.id),s()}catch(t){alert(`Silme islemi basarisiz: ${t instanceof Error?t.message:"Bilinmeyen hata"}`)}})(t),style:{border:"none",background:"transparent",cursor:"pointer",color:i.error.DEFAULT,padding:4},title:"Sil",children:e.jsx(f,{size:16})})]})})]},t.id);var n})})]})})]})}function N({invoices:r,onRefresh:a}){const l=r.filter(e=>e.reminderType),s={pending:l.filter(e=>"PENDING"===e.reminderStatus),sent:l.filter(e=>"SENT"===e.reminderStatus),read:l.filter(e=>"READ"===e.reminderStatus),ignored:l.filter(e=>"IGNORED"===e.reminderStatus),bounced:l.filter(e=>"BOUNCED"===e.reminderStatus)},c=e=>({[k.EMAIL]:"E-posta",[k.SMS]:"SMS",[k.IN_APP]:"Uygulama İçi",[k.LETTER]:"Mektup"}[e]||e);return 0===l.length?e.jsx(t,{children:e.jsxs("div",{style:{textAlign:"center",padding:40},children:[e.jsx("div",{style:{fontSize:n.fontSize.lg,fontWeight:n.fontWeight.semibold,marginBottom:8},children:"Hatırlatıcı Yok"}),e.jsx("div",{style:{fontSize:n.fontSize.sm,color:i.muted},children:"Henüz hatırlatıcı ayarlanmış fatura yok. Fatura oluşturulduktan sonra hatırlatıcı ekleyebilirsiniz."})]})}):e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(150px,1fr))",gap:12},children:[{key:"pending",label:"Beklemede",count:s.pending.length,color:i.accent[400]},{key:"sent",label:"Gönderildi",count:s.sent.length,color:i.success.DEFAULT},{key:"read",label:"Okundu",count:s.read.length,color:i.info.DEFAULT},{key:"ignored",label:"Göz Ardı",count:s.ignored.length,color:i.muted},{key:"bounced",label:"Geri Döndü",count:s.bounced.length,color:i.error.DEFAULT}].map(r=>e.jsxs(t,{style:{padding:12,textAlign:"center"},children:[e.jsx("div",{style:{fontSize:n.fontSize.xs,color:i.muted,marginBottom:4},children:r.label}),e.jsx("div",{style:{fontSize:n.fontSize.xl,fontWeight:n.fontWeight.bold,color:r.color},children:r.count})]},r.key))}),e.jsxs(t,{children:[e.jsx("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${i.border}`},children:e.jsxs("h3",{style:{margin:0,fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,display:"flex",alignItems:"center",gap:6},children:[e.jsx(S,{size:16,color:i.accent[400],"aria-hidden":!0})," Gönderilmesi Beklenen Hatırlatıcılar (",s.pending.length,")"]})}),s.pending.length>0?e.jsx("div",{style:{display:"grid",gap:12},children:s.pending.map(t=>e.jsxs("div",{style:{padding:12,background:i.bg.subtle,borderRadius:o.md,border:`1px solid ${i.border}`,display:"grid",gridTemplateColumns:"1fr auto",gap:12,alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:n.fontWeight.semibold},children:t.invoiceNumber}),e.jsxs("div",{style:{fontSize:n.fontSize.xs,color:i.muted,marginTop:4},children:[c(t.reminderType||"")," • Gönderim: ",t.nextReminderDate?new Date(t.nextReminderDate).toLocaleDateString("tr-TR"):"—"]}),e.jsxs("div",{style:{fontSize:n.fontSize.xs,color:i.muted,marginTop:2},children:["Tutar: ₺",(t.totalAmount??0).toLocaleString("tr-TR",{maximumFractionDigits:2})," • Kalan: ₺",(t.remainingAmount??0).toLocaleString("tr-TR",{maximumFractionDigits:2})]})]}),e.jsx(d,{variant:"primary",size:"sm",icon:e.jsx(T,{size:14}),disabled:!0,title:"Yakında",children:"Şimdi Gönder"})]},t.id))}):e.jsx("div",{style:{textAlign:"center",padding:20,color:i.muted},children:"Gönderilmesi beklenen hatırlatıcı yok"})]}),s.sent.length>0&&e.jsxs(t,{children:[e.jsx("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${i.border}`},children:e.jsxs("h3",{style:{margin:0,fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,display:"flex",alignItems:"center",gap:6},children:[e.jsx(z,{size:16,color:i.success.DEFAULT,"aria-hidden":!0})," Gönderilen Hatırlatıcılar (",s.sent.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:8},children:s.sent.map(t=>e.jsxs("div",{style:{padding:12,background:i.bg.subtle,borderRadius:o.md,fontSize:n.fontSize.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:n.fontWeight.semibold},children:t.invoiceNumber}),e.jsxs("div",{style:{color:i.muted,marginTop:4},children:[c(t.reminderType||"")," • ",t.reminderCount," kez • Gönderim: ",t.reminderSentAt?new Date(t.reminderSentAt).toLocaleDateString("tr-TR"):"—"]})]}),e.jsx(z,{size:16,color:i.success.DEFAULT})]},t.id))})]}),s.read.length>0&&e.jsxs(t,{children:[e.jsx("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${i.border}`},children:e.jsxs("h3",{style:{margin:0,fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,display:"flex",alignItems:"center",gap:6},children:[e.jsx(v,{size:16,color:i.info.DEFAULT,"aria-hidden":!0})," Okunan Hatırlatıcılar (",s.read.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:8},children:s.read.map(t=>e.jsxs("div",{style:{padding:12,background:i.bg.subtle,borderRadius:o.md,fontSize:n.fontSize.sm},children:[t.invoiceNumber," • ",c(t.reminderType||"")]},t.id))})]}),(s.ignored.length>0||s.bounced.length>0)&&e.jsxs(t,{style:{border:`1px solid ${i.error.DEFAULT}`,background:i.error.light},children:[e.jsx("div",{style:{marginBottom:16,paddingBottom:12,borderBottom:`1px solid ${i.error.DEFAULT}`},children:e.jsxs("h3",{style:{margin:0,fontSize:n.fontSize.base,fontWeight:n.fontWeight.semibold,color:i.error.DEFAULT,display:"flex",alignItems:"center",gap:6},children:[e.jsx(x,{size:16,"aria-hidden":!0})," Sorunlu Hatırlatıcılar (",s.ignored.length+s.bounced.length,")"]})}),e.jsx("div",{style:{display:"grid",gap:8},children:[...s.ignored,...s.bounced].map(t=>{return e.jsxs("div",{style:{padding:12,background:i.bg.subtle,borderRadius:o.md,fontSize:n.fontSize.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:n.fontWeight.semibold},children:t.invoiceNumber}),e.jsxs("div",{style:{color:i.muted,marginTop:4},children:[c(t.reminderType||"")," • ",(r=t.reminderStatus||"PENDING",{PENDING:"Beklemede",SENT:"Gönderildi",READ:"Okundu",IGNORED:"Göz Ardı Edildi",BOUNCED:"Geri Döndü"}[r]||r)]})]}),e.jsx(d,{variant:"secondary",size:"sm",icon:e.jsx(D,{size:14}),disabled:!0,title:"Yakında",children:"Yeniden Gönder"})]},t.id);var r})})]})]})}function w({embedded:t=!1}){const[r,o]=m.useState("invoices"),[a,l]=m.useState([]),[g,x]=m.useState(!0),[h,y]=m.useState(!1),[f,b]=m.useState(null);m.useEffect(()=>{j()},[]);const j=async()=>{try{x(!0);const e=await L.list();l(e)}catch(e){}finally{x(!1)}},v=a.length,S=a.filter(e=>e.status===R.PAID).reduce((e,t)=>e+(t.totalAmount??0),0),z=a.filter(e=>e.status===R.PENDING||e.status===R.PARTIAL).reduce((e,t)=>e+(t.remainingAmount??0),0),T=a.filter(e=>e.status===R.OVERDUE).length,D=a.filter(e=>"PENDING"===e.reminderStatus&&e.reminderType).length,k=()=>{y(!1),b(null)};return e.jsxs("div",{children:[!t&&e.jsx(s,{title:"Tahsilat Yönetimi",subtitle:"Faturaları ve ödeme hatırlatıcılarını yönet",breadcrumbs:["Ana İşlemler","Tahsilat"],children:e.jsx(d,{variant:"primary",size:"sm",icon:e.jsx(A,{size:16}),onClick:()=>{b(null),y(!0)},children:"Yeni Fatura"})}),t&&e.jsx("div",{style:{padding:"12px 0 0",display:"flex",justifyContent:"flex-end"},children:e.jsx(d,{variant:"primary",size:"sm",icon:e.jsx(A,{size:16}),onClick:()=>{b(null),y(!0)},children:"Yeni Fatura"})}),e.jsxs("div",{style:{padding:24,maxWidth:1400,margin:"0 auto",display:"grid",gap:20},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",gap:16},children:[e.jsx(c,{icon:"BI",label:"Toplam Fatura",value:v,color:i.primary[500]}),e.jsx(c,{icon:"PD",label:"Ödenen Tutar",value:`₺${S.toLocaleString("tr-TR",{maximumFractionDigits:0})}`,color:i.success.DEFAULT}),e.jsx(c,{icon:"PA",label:"Bekleyen Tutar",value:`₺${z.toLocaleString("tr-TR",{maximumFractionDigits:0})}`,color:i.accent[400]}),e.jsx(c,{icon:"OD",label:"Vadesi Geçmiş",value:T,color:i.error.DEFAULT}),e.jsx(c,{icon:"RM",label:"Bekleyen Hatırlatma",value:D,color:i.info.DEFAULT})]}),e.jsx("div",{style:{display:"flex",gap:8,borderBottom:`1px solid ${i.border}`},children:[{id:"invoices",label:"Faturalar",icon:e.jsx(E,{size:14,"aria-hidden":!0})},{id:"reminders",label:"Hatırlatıcılar",icon:e.jsx(p,{size:14,"aria-hidden":!0})}].map(t=>e.jsxs("button",{onClick:()=>o(t.id),style:{padding:"12px 16px",border:"none",background:"transparent",cursor:"pointer",fontSize:n.fontSize.sm,fontWeight:n.fontWeight.medium,color:r===t.id?i.primary[500]:i.muted,borderBottom:r===t.id?`2px solid ${i.primary[500]}`:"none",transition:u.fast,display:"flex",alignItems:"center",gap:6},children:[t.icon," ",t.label]},t.id))}),"invoices"===r&&e.jsx(W,{invoices:a,loading:g,onEdit:e=>{b(e),y(!0)},onRefresh:j}),"reminders"===r&&e.jsx(N,{invoices:a,onRefresh:j})]}),h&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:k,children:e.jsx("div",{onClick:e=>e.stopPropagation(),children:e.jsx(_,{invoice:f,onSubmit:async e=>{await j(),y(!1),b(null)},onClose:k})})})]})}export{w as default};
