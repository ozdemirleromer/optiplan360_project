import{h as e,j as t,c as i,C as r,R as s,B as a}from"./index-BqsYehSy.js";import{r as l,S as n,P as o,at as d,T as c,e as m}from"./ui-vendor-X7YeR1nJ.js";import"./react-vendor-BTlmOg1k.js";import"./export-jspdf-ClKeqeik.js";import"./state-CRAppeNE.js";import"./export-xlsx-C5xT2hrF.js";function u(e){const t=Array.isArray(e.supplierItems)?e.supplierItems.map(e=>({id:Number(e.id),brandName:String(e.brandName??""),displayName:String(e.displayName??""),isDefault:Boolean(e.isDefault)})):[];return{id:Number(e.id??0),productTypeName:String(e.productTypeName??""),colorName:String(e.colorName??""),thicknessMm:Number(e.thicknessMm??0),widthCm:Number(e.widthCm??0),heightCm:Number(e.heightCm??0),specHash:String(e.specHash??""),matchStatus:e.matchStatus??"NO_MATCH",supplierItems:t}}const p={async searchSpecs(t){const i=new URLSearchParams;(null==t?void 0:t.query)&&i.set("query",t.query),(null==t?void 0:t.productTypeId)&&i.set("product_type_id",String(t.productTypeId)),(null==t?void 0:t.colorId)&&i.set("color_id",String(t.colorId)),(null==t?void 0:t.thicknessMm)&&i.set("thickness_mm",String(t.thicknessMm)),(null==t?void 0:t.widthCm)&&i.set("width_cm",String(t.widthCm)),(null==t?void 0:t.heightCm)&&i.set("height_cm",String(t.heightCm)),(null==t?void 0:t.limit)&&i.set("limit",String(t.limit));const r=i.toString(),s=await e("/products/search"+(r?"?"+r:""),{method:"GET"}),a=Array.isArray(s.results)?s.results.map(u):[];return{results:a,total:Number(s.total??a.length)}},async resolveIncoming(t,i,r){const s=new URLSearchParams;return s.set("brand_id",String(i)),r&&s.set("item_id",String(r)),e(`/products/incoming/${t}/resolve?${s.toString()}`,{method:"POST"})}},h={MATCHED:{label:"Eslesti",color:"#22c55e",icon:m},AMBIGUOUS:{label:"Birden fazla firma",color:"#f59e0b",icon:c},NO_MATCH:{label:"Eslesme yok",color:"#ef4444",icon:d}};function g(){const[e,d]=l.useState(""),[c,m]=l.useState([]),[u,g]=l.useState(0),[x,y]=l.useState(!1),[f,b]=l.useState(!1),[S,j]=l.useState(null),v=l.useCallback(async()=>{if(e.trim()){y(!0),j(null);try{const t=await p.searchSpecs({query:e.trim(),limit:50});m(t.results),g(t.total),b(!0)}catch(t){j({type:"error",text:t instanceof Error?t.message:"Arama basarisiz"})}finally{y(!1)}}},[e]);return t.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[t.jsx(i,{title:"Urun Arama (Spec-first)"}),t.jsxs("div",{style:{padding:24,flex:1,overflowY:"auto"},children:[t.jsxs("form",{onSubmit:e=>{e.preventDefault(),v()},style:{display:"flex",gap:8,marginBottom:20,maxWidth:600},children:[t.jsxs("div",{style:{flex:1,position:"relative"},children:[t.jsx(n,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:r.gray[400]},"aria-hidden":"true"}),t.jsx("input",{id:"spec-search-input",type:"text",placeholder:"Orn: BEYAZ 18, MDF 5mm, SUNTALAM...",value:e,onChange:e=>d(e.target.value),"aria-label":"Urun arama metni",style:{width:"100%",padding:"10px 12px 10px 36px",borderRadius:s.md,border:`1px solid ${r.border}`,background:r.bg.elevated,color:r.text,fontSize:14,outline:"none"}})]}),t.jsx(a,{type:"submit",variant:"primary",size:"sm",disabled:x||!e.trim(),children:x?"Araniyor...":"Ara"})]}),S&&t.jsx("div",{style:{padding:"8px 16px",borderRadius:s.md,backgroundColor:"error"===S.type?"#fef2f2":"#f0fdf4",color:"error"===S.type?"#dc2626":"#16a34a",fontSize:13,marginBottom:16},children:S.text}),f&&0===c.length&&!x&&t.jsxs("div",{style:{textAlign:"center",padding:40,color:r.gray[400],fontSize:14},children:[t.jsx(o,{size:40,style:{marginBottom:12,opacity:.4},"aria-hidden":"true"}),t.jsx("div",{children:"Aramanizla eslesen urun bulunamadi."}),t.jsx("div",{style:{fontSize:12,marginTop:4},children:"Farkli anahtar kelimeler deneyin (orn: renk, kalinlik, malzeme turu)."})]}),c.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{fontSize:12,color:r.gray[400],marginBottom:12},children:[u," sonuc bulundu"]}),t.jsx("div",{style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(340px, 1fr))"},children:c.map(e=>{const i=h[e.matchStatus]??h.NO_MATCH,a=i.icon;return t.jsxs("div",{style:{border:`1px solid ${r.border}`,borderRadius:s.lg,padding:16,background:r.bg.elevated,display:"flex",flexDirection:"column",gap:10},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:14,fontWeight:600,color:r.text},children:[e.productTypeName," — ",e.colorName]}),t.jsxs("div",{style:{fontSize:12,color:r.gray[400],marginTop:2},children:[e.thicknessMm,"mm | ",e.widthCm,"×",e.heightCm," cm"]})]}),t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:4,padding:"2px 8px",borderRadius:s.full,fontSize:11,fontWeight:600,backgroundColor:i.color+"18",color:i.color,border:`1px solid ${i.color}33`},children:[t.jsx(a,{size:12,"aria-hidden":"true"}),i.label]})]}),e.supplierItems.length>0&&t.jsxs("div",{style:{fontSize:12,color:r.gray[400]},children:[t.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Tedarikciler:"}),e.supplierItems.map(e=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"3px 0"},children:[t.jsx("span",{style:{fontWeight:e.isDefault?700:400},children:e.brandName}),t.jsxs("span",{style:{color:r.gray[400]},children:["— ",e.displayName]}),e.isDefault&&t.jsx("span",{style:{fontSize:10,padding:"1px 6px",borderRadius:s.sm,backgroundColor:"#22c55e22",color:"#22c55e"},children:"Varsayilan"})]},e.id))]}),"NO_MATCH"===e.matchStatus&&t.jsx("div",{style:{fontSize:11,padding:"6px 10px",borderRadius:s.md,backgroundColor:"#fef2f2",color:"#dc2626"},children:"Bu urun icin tedarikci eslesmesi bulunamadi. Urun talebi olusturuldu."}),"AMBIGUOUS"===e.matchStatus&&t.jsx("div",{style:{fontSize:11,padding:"6px 10px",borderRadius:s.md,backgroundColor:"#fffbeb",color:"#d97706"},children:"Birden fazla tedarikci eslesti. Lutfen tercih belirleyin."})]},e.id)})})]})]})]})}export{g as default};
