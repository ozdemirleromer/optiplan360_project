import{g as e,C as t,j as r,c as a,R as s,T as l,p as i,B as o,K as n,d,e as c,n as p}from"./index-BqsYehSy.js";import{r as m}from"./ui-vendor-X7YeR1nJ.js";import"./react-vendor-BTlmOg1k.js";import"./export-jspdf-ClKeqeik.js";import"./state-CRAppeNE.js";import"./export-xlsx-C5xT2hrF.js";function u(){const[u,x]=m.useState("7d"),[g,h]=m.useState(null),[f,j]=m.useState([]),[,y]=m.useState(!0);m.useEffect(()=>{(async()=>{try{y(!0);const[e,t]=await Promise.all([c.getStats(),p.list()]);h(e),j(t)}catch(e){}finally{y(!1)}})()},[u]);const b=(null==g?void 0:g.totalOrders)??0,v=f.reduce((t,r)=>t+e(r.parts,0),0),k=f.filter(e=>"CANCELLED"===e.status).length,S=b>0?(k/b*100).toFixed(1):"0.0",L=(()=>{const e={};return f.forEach(t=>{const r="Sistem";e[r]=(e[r]??0)+1}),Object.entries(e).map(([r,a])=>({name:r,orders:a,color:[t.info.DEFAULT,t.accent[400],t.success.DEFAULT,t.primary[500]][Object.keys(e).indexOf(r)%4]})).sort((e,t)=>t.orders-e.orders).slice(0,3)})(),R=Math.max(...L.map(e=>e.orders),1);return r.jsxs("div",{children:[r.jsxs(a,{title:"Raporlar",subtitle:"Üretim ve performans raporları",breadcrumbs:["Ana İşlemler","Raporlar"],children:[r.jsx("div",{style:{display:"flex",gap:4,background:"rgba(255,255,255,.04)",border:`1px solid ${t.border}`,borderRadius:s.lg,padding:3},children:[{k:"1d",l:"Bugün"},{k:"7d",l:"7 Gün"},{k:"30d",l:"30 Gün"},{k:"90d",l:"90 Gün"}].map(e=>r.jsx("button",{onClick:()=>x(e.k),style:{padding:"6px 12px",borderRadius:s.md,border:"none",cursor:"pointer",fontSize:12,background:u===e.k?i(.15):"transparent",color:u===e.k?t.primary[500]:t.muted,fontWeight:u===e.k?l.fontWeight.semibold:l.fontWeight.normal},children:e.l},e.k))}),r.jsx(o,{variant:"secondary",size:"sm",icon:"DL",onClick:()=>{const t={generatedAt:(new Date).toISOString(),dateRange:u,totalOrders:b,totalParts:v,cancellationRate:S,orders:f.map(t=>({id:t.id,cust:t.cust,mat:t.mat,status:t.status,parts:e(t.parts,0),date:t.date}))},r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`rapor_${(new Date).toISOString().slice(0,10)}.json`,s.click(),URL.revokeObjectURL(a)},children:"Dışa Aktar"})]}),r.jsxs("div",{style:{padding:24,maxWidth:1320,margin:"0 auto",display:"grid",gap:20},children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(220px,1fr))",gap:16},children:[r.jsx(n,{icon:"SP",label:"Toplam Sipariş",value:b,color:t.primary[500],sparkData:(null==g?void 0:g.weeklyValues)??[]}),r.jsx(n,{icon:"SR",label:"Ortalama Süre",value:f.length>0?`${(f.length/7).toFixed(1)}/gün`:"—",color:t.accent[400]}),r.jsx(n,{icon:"PR",label:"Toplam Parça",value:v,color:t.info.DEFAULT,sparkData:(null==g?void 0:g.weeklyValues)??[]}),r.jsx(n,{icon:"IP",label:"İptal Oranı",value:`%${S}`,color:t.error.DEFAULT})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(360px,1fr))",gap:16},children:[r.jsx(d,{title:"Operatör Performansı",children:r.jsx("div",{children:L.length>0?L.map((e,a)=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 0",borderBottom:a<L.length-1?`1px solid ${t.border}`:"none"},children:[r.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:`${e.color}18`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,fontWeight:l.fontWeight.bold,color:e.color},children:a+1}),r.jsxs("div",{style:{flex:1},children:[r.jsx("div",{style:{fontSize:13,color:t.text},children:e.name}),r.jsxs("div",{style:{fontSize:11,color:t.muted},children:[e.orders," sipariş"]})]}),r.jsx("div",{style:{width:100,height:5,borderRadius:3,background:"rgba(255,255,255,.06)"},children:r.jsx("div",{style:{width:e.orders/R*100+"%",height:"100%",borderRadius:3,background:e.color}})})]},a)):r.jsx("div",{style:{color:t.muted,fontSize:12},children:"Veri yok"})})}),r.jsx(d,{title:"Malzeme Dağılımı",children:g&&g.materialLabels&&g.materialLabels.length>0?(()=>{const e=(g.materialValues??[]).reduce((e,t)=>e+t,0);return g.materialLabels.map((a,s)=>{var i;const o=e>0?(((null==(i=g.materialValues)?void 0:i[s])??0)/e*100).toFixed(0):"0",n=[t.accent[400],t.primary[500],t.info.DEFAULT,t.success.DEFAULT,t.gray[400]];return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 0",borderBottom:s<g.materialLabels.length-1?`1px solid ${t.border}`:"none"},children:[r.jsx("span",{style:{width:10,height:10,borderRadius:2,background:n[s%n.length],flexShrink:0}}),r.jsx("span",{style:{flex:1,fontSize:12,color:t.text},children:a}),r.jsxs("span",{style:{fontSize:12,fontWeight:l.fontWeight.bold,color:n[s%n.length]},children:[o,"%"]})]},s)})})():r.jsx("div",{style:{color:t.muted,fontSize:12},children:"Veri yok"})})]})]})]})}export{u as Reports};
