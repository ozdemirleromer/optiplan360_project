import{j as e,c as t,d as i,C as r,e as s}from"./index-BqsYehSy.js";import{r as l}from"./ui-vendor-X7YeR1nJ.js";function n(e,t,i){const[r,s]=l.useState(!1),[n,o]=l.useState(null),d=l.useRef(e),a=l.useRef(t),c=l.useRef(i);d.current=e,a.current=t,c.current=i;return{execute:l.useCallback(async(...e)=>{var t,i;s(!0),o(null);try{const i=await d.current(...e);return null==(t=a.current)||t.call(a,i),i}catch(r){const e=r instanceof Error?r.message:"Islem basarisiz oldu";throw o(e),null==(i=c.current)||i.call(c,r),r}finally{s(!1)}},[]),loading:r,error:n,setError:o}}function o(){const[o,d]=l.useState([]),[a,c]=l.useState([]),[,u]=l.useState(null),[p,y]=l.useState("activities"),[x,h]=l.useState({user:"",activity_type:"",resource_type:"",dateFrom:"",dateTo:""}),[v,g]=l.useState(!0),[m,j]=l.useState(null),{execute:f}=n(()=>s.getUserActivities({activity_type:x.activity_type||void 0,resource_type:x.resource_type||void 0,limit:200}),e=>{d(e),g(!1)},e=>{j("Aktiviteler yüklenemedi"),g(!1)}),{execute:A}=n(()=>s.getUserSessions({limit:100}),e=>c(e),e=>{}),{execute:T}=n(()=>s.getActivityStats(),e=>u(e),e=>{});l.useEffect(()=>{f(),A(),T()},[f,A,T,x]);const S=l.useMemo(()=>o.filter(e=>{const t=!x.user||e.userId.toString().includes(x.user),i=!x.dateFrom&&!x.dateTo||new Date(e.createdAt)>=new Date(x.dateFrom||"1970-01-01")&&new Date(e.createdAt)<=new Date(x.dateTo||"2099-12-31");return t&&i}),[o,x]),b=l.useMemo(()=>({total:o.length,logins:o.filter(e=>"LOGIN"===e.activityType).length,creates:o.filter(e=>"CREATE"===e.activityType).length,updates:o.filter(e=>"UPDATE"===e.activityType).length,deletes:o.filter(e=>"DELETE"===e.activityType).length}),[o]),E=l.useMemo(()=>a.filter(e=>e.isActive).length,[a]);return e.jsxs("div",{className:"electric-page",children:[e.jsx(t,{title:"Kullanıcı Aktivitesi",subtitle:"Sistem üzerindeki tüm kullanıcı eylemlerini ve oturumlarını izle",breadcrumbs:["Yönetim","Aktivite"]}),e.jsxs("div",{className:"app-page-container",style:{display:"grid",gap:16},children:[m&&e.jsx(i,{style:{background:"rgba(239, 68, 68, 0.1)"},children:e.jsx("div",{style:{color:r.error.DEFAULT},children:m})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:12},children:[e.jsx(i,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700,color:r.primary[500]},children:b.total}),e.jsx("div",{style:{fontSize:12,color:r.muted},children:"Toplam Aktiviteler"})]})}),e.jsx(i,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700,color:r.success.DEFAULT},children:b.logins}),e.jsx("div",{style:{fontSize:12,color:r.muted},children:"Girişler"})]})}),e.jsx(i,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700,color:r.info[500]},children:E}),e.jsx("div",{style:{fontSize:12,color:r.muted},children:"Aktif Oturumlar"})]})}),e.jsx(i,{children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:700,color:r.accent[400]},children:b.creates}),e.jsx("div",{style:{fontSize:12,color:r.muted},children:"Oluşturmalar"})]})})]}),e.jsxs("div",{style:{display:"flex",gap:12,borderBottom:`1px solid ${r.border}`,marginBottom:12},children:[e.jsx("button",{onClick:()=>y("activities"),style:{padding:"12px 16px",background:"activities"===p?r.primary[500]:"transparent",color:"activities"===p?"white":r.muted,border:"none",cursor:"pointer",fontWeight:"activities"===p?600:500},children:"Aktiviteler"}),e.jsx("button",{onClick:()=>y("sessions"),style:{padding:"12px 16px",background:"sessions"===p?r.primary[500]:"transparent",color:"sessions"===p?"white":r.muted,border:"none",cursor:"pointer",fontWeight:"sessions"===p?600:500},children:"Oturumlar"})]}),"activities"===p&&e.jsx(i,{title:"Filtreleme",children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(200px,1fr))",gap:12},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:r.muted},children:"Aktivite Türü"}),e.jsxs("select",{value:x.activity_type,onChange:e=>h(t=>({...t,activity_type:e.target.value})),children:[e.jsx("option",{value:"",children:"Tümü"}),e.jsx("option",{value:"LOGIN",children:"Giriş"}),e.jsx("option",{value:"LOGOUT",children:"Çıkış"}),e.jsx("option",{value:"CREATE",children:"Oluştur"}),e.jsx("option",{value:"UPDATE",children:"Güncelle"}),e.jsx("option",{value:"DELETE",children:"Sil"}),e.jsx("option",{value:"EXPORT",children:"Dışa Aktar"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:12,color:r.muted},children:"Kaynak Türü"}),e.jsxs("select",{value:x.resource_type,onChange:e=>h(t=>({...t,resource_type:e.target.value})),children:[e.jsx("option",{value:"",children:"Tümü"}),e.jsx("option",{value:"order",children:"Sipariş"}),e.jsx("option",{value:"user",children:"Kullanıcı"}),e.jsx("option",{value:"station",children:"İstasyon"}),e.jsx("option",{value:"config",children:"Konfigürasyon"}),e.jsx("option",{value:"invoice",children:"Fatura"})]})]})]})}),"activities"===p&&e.jsx(i,{title:`Aktivite Günlüğü (${S.length})`,children:v?e.jsx("div",{style:{textAlign:"center",padding:40,color:r.muted},children:"Yükleniyor..."}):0===S.length?e.jsx("div",{style:{textAlign:"center",padding:40,color:r.muted},children:"Aktivite bulunamadı"}):S.map(t=>{return e.jsxs("div",{style:{padding:12,borderBottom:`1px solid ${r.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:(i=t.activityType,{LOGIN:r.success.DEFAULT,LOGOUT:r.warning.DEFAULT,CREATE:r.info[500],UPDATE:r.accent[400],DELETE:r.error.DEFAULT,VIEW:r.muted,EXPORT:r.primary[500],IMPORT:r.primary[500]}[i]||r.gray[400])}}),e.jsxs("div",{style:{fontWeight:600},children:[t.activityType," • ",t.resourceType]}),t.resourceName&&e.jsxs("div",{style:{fontSize:12,color:r.muted},children:["(",t.resourceName,")"]})]}),e.jsxs("div",{style:{fontSize:12,color:r.muted,marginTop:4},children:["User #",t.userId," ",t.ipAddress&&`• ${t.ipAddress}`]}),t.description&&e.jsx("div",{style:{fontSize:12,color:r.gray[500],marginTop:4},children:t.description})]}),e.jsx("div",{style:{fontSize:11,color:r.gray[400],textAlign:"right",minWidth:120},children:new Date(t.createdAt).toLocaleString("tr-TR")})]},t.id);var i})}),"sessions"===p&&e.jsx(i,{title:`Aktif Oturumlar (${E})`,children:0===a.length?e.jsx("div",{style:{textAlign:"center",padding:40,color:r.muted},children:"Oturum bulunamadı"}):a.map(t=>e.jsxs("div",{style:{padding:12,borderBottom:`1px solid ${r.border}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{fontWeight:600},children:["User #",t.userId," ",e.jsx("span",{style:{display:"inline-block",padding:"2px 8px",background:t.isActive?r.success.DEFAULT:r.gray[300],color:"white",borderRadius:4,fontSize:11,marginLeft:8},children:t.isActive?"AÇIK":"KAPALI"})]}),e.jsxs("div",{style:{fontSize:12,color:r.muted,marginTop:4},children:[t.deviceType||"Web"," • ",t.ipAddress||"N/A"]}),e.jsxs("div",{style:{fontSize:11,color:r.gray[400],marginTop:4},children:["Giriş: ",new Date(t.loginAt).toLocaleString("tr-TR"),t.logoutAt&&` • Çıkış: ${new Date(t.logoutAt).toLocaleString("tr-TR")}`]})]}),e.jsx("div",{style:{display:"flex",gap:8},children:t.isActive&&e.jsx("button",{onClick:async()=>{try{await s.terminateSession(t.id),c(e=>e.map(e=>e.id===t.id?{...e,isActive:!1,logoutAt:(new Date).toISOString()}:e))}catch(e){}},style:{padding:"6px 12px",background:r.error.DEFAULT,color:"white",border:"none",borderRadius:4,cursor:"pointer",fontSize:12},children:"Sonlandır"})})]},t.id))})]})]})}export{o as U};
