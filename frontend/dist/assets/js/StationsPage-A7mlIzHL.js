import{a as e,e as s,j as a,c as i,C as t,T as n,M as l,R as o,B as r,f as d,d as c}from"./index-BqsYehSy.js";import{r as p,aE as x,aF as m,a7 as y,m as u,ac as g,Y as h,V as f,A as j,aG as b,aH as v,T as k,av as z,f as A,a as T}from"./ui-vendor-X7YeR1nJ.js";import{D as S}from"./OrganizationPage-DgL4Flpk.js";const C=[{key:"ebatlama",label:"EBATLAMA",deviceName:"Cihaz 1",icon:a.jsx(x,{size:18}),color:"#3b82f6",stationNames:["HAZIRLIK","EBATLAMA"],steps:[{scan:1,stationName:"HAZIRLIK",label:"Ürün Hazırlık"},{scan:2,stationName:"EBATLAMA",label:"Ebatlama İşlemi"}],maxScans:2,hasWaitRule:!0,description:"1. okutma ile ürün hazırlığa alınır, 30 dakika sonra 2. okutma ile ebatlama tamamlanır."},{key:"bantlama",label:"BANTLAMA",deviceName:"Cihaz 2",icon:a.jsx(m,{size:18}),color:"#8b5cf6",stationNames:["BANTLAMA"],steps:[{scan:1,stationName:"BANTLAMA",label:"Bantlama İşlemi"}],maxScans:1,hasWaitRule:!1,description:"Tek okutma ile bantlama tamamlanır. Bekleme süresi kuralı yoktur."},{key:"teslim",label:"TESLİM",deviceName:"Cihaz 3",icon:a.jsx(y,{size:18}),color:"#10b981",stationNames:["KONTROL","TESLİMAT"],steps:[{scan:1,stationName:"KONTROL",label:"Teslimata Hazır"},{scan:2,stationName:"TESLİMAT",label:"Teslimat Yapıldı"}],maxScans:2,hasWaitRule:!0,description:"1. okutma ile kontrol başlar, 30 dakika sonra 2. okutma ile teslimat tamamlanır."}],B=[{key:"ebatlama",label:"EBATLAMA",icon:a.jsx(x,{size:16})},{key:"bantlama",label:"BANTLAMA",icon:a.jsx(m,{size:16})},{key:"teslim",label:"TESLİM",icon:a.jsx(y,{size:16})},{key:"devices",label:"Cihaz Yönetimi",icon:a.jsx(u,{size:16})}];function L(){const[d,c]=p.useState("ebatlama"),[x,m]=p.useState([]),[y,u]=p.useState(!0),[g,h]=p.useState(0),[f,j]=p.useState(!1),[b,v]=p.useState(null),[k,z]=p.useState({name:"",description:""}),{addToast:A}=e(),T=p.useCallback(async()=>{try{u(!0);const e=await s.getStations();m(e)}catch(e){const s=e instanceof Error?e.message:"İstasyonlar yüklenemedi";A(`Hata: ${s}`,"error")}finally{u(!1)}},[A]);p.useEffect(()=>{T()},[T,g]);const L=C.find(e=>e.key===d);return a.jsxs("div",{className:"electric-page",children:[a.jsx(i,{title:"İstasyonlar Yönetimi",subtitle:"3 Cihaz — 5 İstasyon: Ebatlama, Bantlama, Teslim"}),a.jsxs("div",{className:"app-page-container",children:[a.jsx("div",{style:{display:"flex",gap:"2px",marginBottom:"24px",borderBottom:`1px solid ${t.border}`},children:B.map(e=>{var s;const i=C.find(s=>s.key===e.key),l=d===e.key,o=(null==i?void 0:i.color)||(null==(s=t.primary)?void 0:s.DEFAULT)||"#6366f1";return a.jsxs("button",{onClick:()=>c(e.key),style:{display:"flex",alignItems:"center",gap:"6px",padding:"12px 24px",fontSize:14,fontWeight:l?700:400,color:l?o:t.muted,background:l?`${o}08`:"transparent",border:"none",borderBottom:l?`3px solid ${o}`:"3px solid transparent",cursor:"pointer",fontFamily:n.fontFamily.base,marginBottom:"-1px",transition:"all 0.2s",letterSpacing:i?"0.5px":void 0},children:[e.icon,e.label]},e.key)})}),"devices"===d?a.jsx(S,{}):L?a.jsx(E,{group:L,stations:(N=L,x.filter(e=>N.stationNames.some(s=>e.name.toUpperCase().trim()===s.toUpperCase().trim()))),allStations:x,loading:y,onRefresh:()=>h(e=>e+1),onToggle:async function(e){try{await s.toggleStation(e),A("İstasyon durumu değiştirildi","success"),h(e=>e+1)}catch(a){const e=a instanceof Error?a.message:"Durum değiştirilemedi";A(`Hata: ${e}`,"error")}},onDelete:async function(e){if(confirm("Bu istasyonu silmek istediğinizden emin misiniz?"))try{await s.deleteStation(e),A("İstasyon silindi","success"),h(e=>e+1)}catch(a){const e=a instanceof Error?a.message:"Silme işlemi başarısız";A(`Hata: ${e}`,"error")}},onEdit:e=>{v(e),z({name:e.name,description:e.description||""})},onCreate:()=>{z({name:"",description:""}),v(null),j(!0)}}):null,a.jsx(l,{open:f||null!==b,onClose:()=>{j(!1),v(null),z({name:"",description:""})},title:b?"İstasyonu Düzenle":"Yeni İstasyon",children:a.jsxs("div",{style:{padding:"20px",display:"flex",flexDirection:"column",gap:"12px"},children:[a.jsxs("div",{children:[a.jsx("label",{style:{fontSize:13,fontWeight:600,color:t.text,marginBottom:"6px",display:"block"},children:"İstasyon Adı *"}),a.jsxs("select",{value:k.name,onChange:e=>z(s=>({...s,name:e.target.value})),style:{width:"100%",padding:"9px 12px",border:`1px solid ${t.border}`,borderRadius:o.md,fontSize:14,fontFamily:n.fontFamily.base,background:t.panel,color:t.text},children:[a.jsx("option",{value:"",children:"İstasyon Seçin..."}),a.jsx("option",{value:"HAZIRLIK",children:"HAZIRLIK"}),a.jsx("option",{value:"EBATLAMA",children:"EBATLAMA"}),a.jsx("option",{value:"BANTLAMA",children:"BANTLAMA"}),a.jsx("option",{value:"KONTROL",children:"KONTROL"}),a.jsx("option",{value:"TESLİMAT",children:"TESLİMAT"})]})]}),a.jsxs("div",{children:[a.jsx("label",{style:{fontSize:13,fontWeight:600,color:t.text,marginBottom:"6px",display:"block"},children:"Açıklama"}),a.jsx("textarea",{value:k.description,onChange:e=>z(s=>({...s,description:e.target.value})),placeholder:"İstasyon açıklaması",rows:3,style:{width:"100%",padding:"9px 12px",border:`1px solid ${t.border}`,borderRadius:o.md,fontSize:14,fontFamily:n.fontFamily.base,background:t.panel,color:t.text,resize:"vertical"}})]}),a.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"12px"},children:[a.jsx(r,{variant:"ghost",onClick:()=>{j(!1),v(null),z({name:"",description:""})},children:"İptal"}),a.jsx(r,{variant:"primary",onClick:b?async function(){if(b&&k.name.trim())try{await s.updateStation(b.id,k),A("İstasyon güncellendi","success"),v(null),z({name:"",description:""}),h(e=>e+1)}catch(e){const s=e instanceof Error?e.message:"İstasyon güncellenemedi";A(`Hata: ${s}`,"error")}else A("İstasyon adı zorunludur","error")}:async function(){if(k.name.trim())try{await s.createStation(k),A("İstasyon oluşturuldu","success"),z({name:"",description:""}),j(!1),h(e=>e+1)}catch(e){const s=e instanceof Error?e.message:"İstasyon oluşturulamadı";A(`Hata: ${s}`,"error")}else A("İstasyon adı zorunludur","error")},children:b?"Güncelle":"Oluştur"})]})]})})]})]});var N}function E({group:e,stations:s,allStations:i,loading:n,onRefresh:l,onToggle:p,onDelete:x,onEdit:m,onCreate:y}){return a.jsxs("div",{children:[a.jsxs("div",{style:{padding:"20px",background:`${e.color}08`,borderRadius:o.lg,border:`1px solid ${e.color}30`,marginBottom:"24px"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px",flexWrap:"wrap"},children:[a.jsx("div",{style:{width:56,height:56,borderRadius:o.lg,background:`${e.color}20`,display:"flex",alignItems:"center",justifyContent:"center",color:e.color,flexShrink:0},children:e.icon}),a.jsxs("div",{style:{flex:1,minWidth:200},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"6px"},children:[a.jsx("h2",{style:{fontSize:20,fontWeight:700,color:t.text,margin:0},children:e.label}),a.jsx(d,{variant:"info",children:e.deviceName}),e.hasWaitRule&&a.jsx(d,{variant:"warning",children:a.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px"},children:[a.jsx(g,{size:12})," 30 dk Kuralı"]})})]}),a.jsx("p",{style:{fontSize:13,color:t.muted,margin:0,lineHeight:1.5},children:e.description})]}),a.jsxs("div",{style:{display:"flex",gap:"8px",flexShrink:0},children:[a.jsxs(r,{variant:"secondary",size:"sm",onClick:l,children:[a.jsx(h,{size:16})," Yenile"]}),a.jsxs(r,{variant:"primary",size:"sm",onClick:y,children:[a.jsx(f,{size:16})," Yeni İstasyon"]})]})]}),a.jsx("div",{style:{display:"flex",gap:"12px",marginTop:"20px",flexWrap:"wrap"},children:e.steps.map((s,i)=>{var n;return a.jsxs("div",{style:{flex:"1 1 200px",padding:"14px 16px",background:t.bg.surface,borderRadius:o.md,border:`1px solid ${t.border}`,display:"flex",alignItems:"center",gap:"12px"},children:[a.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:`${e.color}20`,color:e.color,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:14,flexShrink:0},children:s.scan}),a.jsxs("div",{children:[a.jsxs("div",{style:{fontSize:12,color:t.muted,marginBottom:"2px"},children:[s.scan,". Okutma"]}),a.jsx("div",{style:{fontSize:14,fontWeight:600,color:t.text},children:s.label}),a.jsx("div",{style:{fontSize:11,color:t.muted,fontFamily:"monospace",marginTop:"2px"},children:s.stationName})]}),i<e.steps.length-1&&e.hasWaitRule&&a.jsxs("div",{style:{marginLeft:"auto",fontSize:11,color:(null==(n=t.warning)?void 0:n.DEFAULT)||"#f59e0b",display:"flex",alignItems:"center",gap:"4px",fontWeight:600},children:[a.jsx(g,{size:12})," 30dk"]})]},s.scan)})})]}),n?a.jsx(c,{title:"Yükleniyor...",children:a.jsxs("div",{style:{padding:"40px",textAlign:"center",color:t.muted},children:[a.jsx(h,{size:32,style:{animation:"spin 1s linear infinite",margin:"0 auto 12px",display:"block"}}),"İstasyonlar yükleniyor..."]})}):0===s.length?a.jsx(c,{title:`${e.label} İstasyonları`,children:a.jsxs("div",{style:{padding:"40px",textAlign:"center",color:t.muted},children:[a.jsx(j,{size:48,style:{margin:"0 auto 12px",display:"block",opacity:.5}}),a.jsx("p",{style:{marginBottom:"8px"},children:"Bu gruba ait istasyon bulunamadı."}),a.jsxs("p",{style:{fontSize:12,marginBottom:"20px"},children:["Beklenen istasyonlar:"," ",a.jsx("strong",{children:e.stationNames.join(", ")})]}),a.jsx(r,{variant:"primary",onClick:y,children:"İstasyon Oluştur"})]})}):a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:"16px"},children:s.map(s=>{var i,n;const l=e.steps.find(e=>e.stationName.toUpperCase()===s.name.toUpperCase());return a.jsxs("div",{style:{padding:"20px",background:t.bg.surface,borderRadius:o.md,border:`1px solid ${t.border}`,borderLeft:`4px solid ${e.color}`,display:"flex",flexDirection:"column"},children:[a.jsxs("div",{style:{marginBottom:"12px",display:"flex",justifyContent:"space-between",alignItems:"start"},children:[a.jsxs("div",{children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[a.jsx("h3",{style:{fontSize:16,fontWeight:700,color:t.text,margin:0},children:s.name}),l&&a.jsxs(d,{variant:"info",children:[l.scan,". Okutma"]})]}),a.jsx("p",{style:{fontSize:13,color:t.muted,margin:0},children:(null==l?void 0:l.label)||s.description||"—"})]}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px"},children:[a.jsx(d,{variant:s.active?"success":"secondary",children:s.active?"Aktif":"Pasif"}),a.jsx(r,{variant:"ghost",size:"sm",onClick:()=>p(s.id),title:s.active?"Durdur":"Başlat",children:a.jsx(b,{size:16,color:s.active?t.success.DEFAULT:t.muted})})]})]}),s.deviceType&&a.jsxs("div",{style:{padding:"10px 12px",background:`${e.color}06`,borderRadius:o.sm,marginBottom:"12px",fontSize:12,display:"flex",flexDirection:"column",gap:"4px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{style:{color:t.muted},children:"Cihaz:"}),a.jsx("span",{style:{fontWeight:600,color:t.text},children:s.deviceModel||s.deviceType||"—"})]}),s.connectionType&&a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{style:{color:t.muted},children:"Bağlantı:"}),a.jsx("span",{style:{fontWeight:500,color:t.text},children:s.connectionType.toUpperCase()})]}),s.ipAddress&&a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsx("span",{style:{color:t.muted},children:"IP:"}),a.jsx("span",{style:{fontWeight:500,color:t.text,fontFamily:"monospace"},children:s.ipAddress})]})]}),a.jsxs("div",{style:{padding:"12px",background:t.bg.main,borderRadius:o.sm,marginBottom:"12px",fontSize:12},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[a.jsxs("span",{style:{color:t.muted,display:"flex",alignItems:"center",gap:"4px"},children:[a.jsx(v,{size:12})," Bugün Okutma:"]}),a.jsx("span",{style:{fontWeight:600,color:t.text},children:s.scanCountToday||0})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsxs("span",{style:{color:t.muted,display:"flex",alignItems:"center",gap:"4px"},children:[a.jsx(g,{size:12})," Son İşlem:"]}),a.jsx("span",{style:{fontWeight:500,color:t.text},children:s.lastScanAt?new Date(s.lastScanAt).toLocaleTimeString("tr-TR"):"—"})]})]}),e.hasWaitRule&&l&&2===l.scan&&a.jsxs("div",{style:{padding:"8px 12px",background:`${(null==(i=t.warning)?void 0:i.DEFAULT)||"#f59e0b"}10`,borderRadius:o.sm,marginBottom:"12px",fontSize:11,color:(null==(n=t.warning)?void 0:n.DEFAULT)||"#f59e0b",display:"flex",alignItems:"center",gap:"6px",fontWeight:500},children:[a.jsx(k,{size:14}),"2. okutma, 1. okutmadan en az 30 dakika sonra yapılmalıdır."]}),a.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"auto"},children:[a.jsxs(r,{variant:"secondary",size:"sm",onClick:()=>m(s),children:[a.jsx(z,{size:14})," Düzenle"]}),a.jsx(r,{variant:"danger",size:"sm",onClick:()=>x(s.id),children:a.jsx(A,{size:14})})]})]},s.id)})}),a.jsxs("div",{style:{marginTop:"32px",padding:"16px",background:t.bg.surface,borderRadius:o.md,border:`1px solid ${t.border}`},children:[a.jsx("h3",{style:{fontSize:14,fontWeight:600,color:t.text,marginBottom:"12px"},children:"Tüm Cihaz-İstasyon Haritası"}),a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px"},children:C.map(e=>{var s,n,l,r;const d=i.filter(s=>e.stationNames.some(e=>s.name.toUpperCase()===e.toUpperCase())),c=d.length>0&&d.every(e=>e.active);return a.jsxs("div",{style:{padding:"12px 14px",background:t.bg.main,borderRadius:o.sm,borderLeft:`3px solid ${e.color}`},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[a.jsx("span",{style:{color:e.color},children:e.icon}),a.jsx("span",{style:{fontSize:13,fontWeight:700,color:t.text},children:e.deviceName}),a.jsxs("span",{style:{fontSize:12,color:t.muted},children:["(",e.label,")"]})]}),a.jsx("div",{style:{fontSize:12,color:t.muted},children:e.steps.map(e=>e.stationName).join(" → ")}),a.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"6px",fontSize:11},children:c?a.jsxs(a.Fragment,{children:[a.jsx(T,{size:12,color:(null==(s=t.success)?void 0:s.DEFAULT)||"#10b981"}),a.jsx("span",{style:{color:(null==(n=t.success)?void 0:n.DEFAULT)||"#10b981",fontWeight:600},children:"Tüm istasyonlar aktif"})]}):a.jsxs(a.Fragment,{children:[a.jsx(k,{size:12,color:(null==(l=t.warning)?void 0:l.DEFAULT)||"#f59e0b"}),a.jsx("span",{style:{color:(null==(r=t.warning)?void 0:r.DEFAULT)||"#f59e0b",fontWeight:600},children:0===d.length?"İstasyon tanımlı değil":`${d.filter(e=>!e.active).length} pasif`})]})})]},e.key)})})]})]})}export{L as S};
